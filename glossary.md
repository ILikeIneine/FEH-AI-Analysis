<h1 align = "center">Glossary</h1>

## 1.Important Concepts

###  	a. Slot Order(位置顺序值)

对于大多数情况下，AI必须在多个角色之间进行选择的情况下，角色顺序是最终的判断方式，唯一的例外是进攻性移动支援。支援角色将检查目标所在的位置。

<center>角色排位顺序是从低到高，从左到右。</center>

![slotorder.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/slotorder.png?raw=true)

在前面提到的的最终判断，较低的槽位将使单位具有移动的优势和支援的优先权。较高的插槽编号将使该单位在被盟友和敌人作为目标时具有更高的优先级，但同时在进行攻击的优先级上也将更具有优势。

敌人也有类似于插槽顺序，不过是基于地图位置的。尽管在竞技场对战的时候，敌人的部署同样也对应的是玩家的位置，但无法一目了然地推算出他们的插槽编号。但是，通常的模式是，在给定的地图中，英雄的插槽位置比普通敌人的插槽位置低。例外情况在FEH wiki里好像都有存储每张地图的敌方插槽顺序信息，可以去搜索: (    （不会真有人是分奴吧？不会吧不会吧不会吧？不会我就是那个分奴吧？）

援军的插槽号是在当前部署单位向后依次推算，已经死亡的单位的插槽不会消失，依旧默认存在，援军会使用最后一个没有没有被使用的插槽。举个例子，如果开局敌人有4个单位，并且在第2回合中出现援军，那么援军将位于第5个位置。

如果在一个回合中会有多个援军空降，且如果他们共享==相同的触发条件==（例如，在第2回合将会出现两个增援部队，或杀死军团(legion)后会出现两个增援部队），那么他们会根据地图，有一个预先分配的任意的槽位顺序。如果他们触发点不同（例如，一个增援来自杀死一个红色法师，而另一个则来自杀死一个蓝色法师），那么它们的槽位值取决于它们各自的部署机制。如果像前面的示例中那样，两个不同的击杀产生了两个增援，则它们的槽位值与其击杀目标的槽位值相对应（红色法师的槽位值，就是击杀而他产生的增援的槽位值，继承）。如果两个援军是同时通过击杀触发和基于回合触发，那么基于击杀触发的援兵的插槽值会优先于基于回合触发产生的援军，槽位值会小1位。

###  	b. Tile Priorty(位置优势)

位置优势（？？？）是当AI在地图上进行行动时，在选择位置的的所有情况下的最终判断依据。位置优先级从地图的左下角开始，从最低到最高编号，向右移动，然后回绕到每一行。因此，最高优先级图块位于地图的右上角。

![tilepriority.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/tilepriority.png?raw=true)

<center >Priority Example</center>

一种形象化地记住这种位置优先级的方法是，记住优先级是：上>右>左>下。更高行的位置总具有更高的优先权，靠右的总比靠左的优先级更高。

### c. Calculating Distance(计算距离)

距离计算是通过一个函数，为了执行各种最终判断，这个函数决定了单位/位置 A 到单位/位置 B 的距离。距离计算是一个单向计算，这意味着从A到B的距离不必与从B到A的距离相同。这是因为，距离借助了A位置单位的移动方式和可能会阻碍因该单位移动的地形因素。

在这里计算距离时，实际上是在计算最短距离。因此，在计算从A到B的距离时，需要找到从A到B的最短路径。当我们构造这些道路时，我们应当附加权值，对于步兵来说，树林相当于两个移动距离；而沟壑对于骑兵则相当于三个瓦片的移动距离。

构造路径时，如果有单位A的移动类型不可穿越的地形是不能使用的。距离计算包括B占用的图块。这意味着，如果B位于单元A不可能移动到的地形上，可能根本没有可行路径。在这种情况下，该距离被认为是“不确定的”，在最终判断时，所有“未定义”的距离均被视为相等。

米娅到各种敌人的距离计算示例：

![distance.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/distance.png?raw=true)

### d. Movement Order List(移动顺序)

很重要的是，移动顺序表是一个回合中唯一被保留参与的计算。每当一个单位执行动作时，从头开始重复计算每个步骤，但回合开始时生成的移动顺序列表除外。由于位置和距离才是运动顺序列表中的决定因素，它在回合中持续存在的事实意味着，任何移动刷新或者玩家使用的支援而导致的位置变化，又或者由于B技能的移动效果而导致与敌人的距离发生变化(i.e. Lunge)，或者简单的因为敌人的死亡，所有这些都不会影响回合中的移动顺序。

需要注意的是，移动顺序列表是在决定一个动作的第一次迭代期间创建的~~（？？?不知道是回合开始阶段还是进行第一个动作的同时基于动作触发创建好，猜测是前一种）~~，对于敌方AI来说，这个列表是在回合开始被创建。但是，对于玩家而言，它是在玩家让AI自动战斗的第一个动作过程中中创建的。如果玩家手动执行动作，然后再打开自动战斗，移动顺序表将会在玩家执行行动后的的背景状态下生成。这意味着即使玩家手动执行AI本来执行的相同的操作，移动顺序表却将由于前后完全不同的状态下被创建，并且导致AI的行动与未经玩家手动操作，而在回合开始阶段直接打开自动战斗的AI行动完全不同。但如果第一个动作是使用自动对战进行的，则玩家执行第二个动作，然后让自动对战再次接管，随后的自动对战仍将使用从自动战斗第一个动作生成的移动顺序列表。

## 2. Special Actions and States

### a. Offensive Movement Assit(进攻性移动支援)

进攻性移动支援是移动支援的一种特殊用法，仅在预战斗期间可用，目前仅涉及推，打，带回和替换。通常情况下，行动支援用于防御，以帮助减少队友的危险。但是，对于进攻性移动支援模式，它试图移动一个队友，以腾出空间让另一个盟友攻击被判断无法攻击到的敌人。这种情况很少见，因为要满足它有很多要求。

![off_move_assist.gif](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/off_move_assist.gif?raw=true)

### b. Bodyblocking

身体阻挡是防御性移动支援的一种特殊方式。它看起来像是正常移动，因为在进行身体阻挡时，身体阻挡者实际上并没有使用其支援技能。但是，身体阻挡者必须装备有防御支援技能，并且能够在目标上使用该技能，只不过身体阻挡是在适用时，代替了支援技能。

![bodyblocking.gif](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/bodyblocking.gif?raw=true)

身位阻挡的目的是通过封锁至少1个敌方近战单位通往队友的路径，以减少敌人对队友的威胁。几乎可以将其视为交换(Swap)的更具攻击性的版本。

### c. Block Breaking

摧毁障碍是一种特殊的运动行为方式。角色对可破坏的障碍进行攻击，但是这一行为与标准移动发生在同一个阶段。首先，一个单位确定其最佳移动位置，然后，所有比该位置更靠近敌人的块都可以被破坏。当然，这个单位也必须能够实际攻击到，比如远程位就不能贴脸打砖块。然后计算所有块的攻击位置。如果有不止一个土块，破坏的最佳选择是最接近最佳移动位置的土块，其次是安全性，然后是块的优先级。如果存在至少一个符合上述描述的块，则单位将会打破土块的动作而不进行移动。如果开始时没有任何适合破坏的块，那么该单位将决定是否要使用Pivot如果装备了，（或者Rally，在很极端的情况下）否则他们会照常移动。

### d. Shuffling

是一种特殊状态，会影响运动行为。一个单位只能在特定条件下获得该状态。首先，如果该单位与它可以到达的任何队友相邻，则该单位将无法获得该状态。这包括自身诱发的传送(e.g. 飞行前导，脱离路线)和队友诱发的(e.g. 支援路线)。下一个条件取决于单位的武器，如下：

如果该单位拥有远程武器，并且在敌人2个距离内或与易碎方块相邻，他们就可以获得该状态。

如果单位没有装备武器，并且在敌人的2个距离内==并且==与队友相邻。

装备有近战武器的单位永远不会获得该状态。

如果一个单位获得了该状态，则保持不动仍然是优先级最低的移动，因此他将尽可能尝试移动。

![shuffling.gif](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/shuffling.gif?raw=true)

该机制的主要目的是减少该单位可能阻止另一个单位进行攻击的机率。这种行为在无武器部队中更可能出现，因为他们更容易站着不动。

### e. Pass

该状态是被某些特定技能赋予的，如装备有穿越或者未锻造的风神弓。受此状态影响的单位计算威胁范围的方式与平时不同，并且此外，在回合开始时不会像其他单位那样存储其移动范围值。相反，他们“记录下”敌人占领的位置，并通过计算时使用其移动范围来计算其威胁，同时将那些记录下的图块视为不可移动至。记录下的位置的列表在这里被称为“障碍物列表”。

除非在战斗中敌方单位的位置发生变化（包括带有pass的单位），敌方单位死亡，或者敌方单位被冲撞或带回影响，否则在回合开始时创建的障碍物清单将不会更改。这意味着即使盟军单位的位置由于移动，使用支援或死亡而发生变化，障碍物的位置也不会更新。万一敌方单位的位置因战斗而改变，障碍物列表分别针对其名单上的每个位置检查，以查看其上是否仍存在敌人或盟军。任何不再有敌人或盟友的位置都将从列表中删除。此外，还将检查每个具有pass技能的单位，以查看它们是否仍满足HP要求。如果他们不再符合要求，他们将失去pass状态。反之亦然。如果某个单位额以前没有pass状态，但现在满足HP要求，则它们将获得pass状态。

## 3. Positioning Tiebreakers(最终定位)

### a. Bodyblocking

可以给阻挡者执行身位阻挡的格子优先级会比其他格子高。这是因为尽管没有使用支援而是仅仅通过移动，身体阻挡也具有与防御性移动辅助同等级的优先级。

### b. Distance

作为最终定位的距离仅与标准运动行为有关。单位将更喜欢跑到离其追杀目标最短距离的格子。

### c. Defense Tiles

假设其他所有条件都相等，则在选择位置时，防御地形的优先级高于没有防御地形的格子。

### d. Enemy Threat

假设所有其他条件均等，则敌方威胁较小的格子要优先于其他敌方威胁较大的格子。如果一块砖处于敌人的移动+攻击范围的判定内，则它被视为受到敌人的威胁。之所以这样表示，是因为移动范围计算存储在回合的开始处，所以如果移动范围在回合的过程中发生变化（e.g. 重装），它仍将使用回合开始时存储的移动范围进行计算。同样之所以这样表示，也是因为地形移动限制（例如墙壁，树木和易碎块）确实会影响敌人可以威胁哪些格子，但是暂时性限制（如其他单位阻挡某些格子或被障碍物阻挡的图块）没有影响。

以类似的效果，敌方威胁似乎也没有考虑那些只能通过远距离传送技能而受到威胁的格子，因为这些格子不在直接移动与攻击范围的判定之内。

### e. Teleportation

假设其他所有条件均相等，则需要远距离传送才能到达的位置优先于标准移动即可以到达的位置。在游戏中，当手动进行移动时，这些格子是浅蓝色的。如果通过远距离传送和使用Pivot均可到达某个格子，则仍将其视为需要传送的图块，并且如果选择了该位置，则将不使用Pivot。

![teleportation.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/teleportation.png?raw=true)

<center>触发传送的来源表：</center>

| Weapons:  | Hinoka's Spear (Special Refine)<br />Nóatún<br />Grimoire<br />Fruit of Iðunn<br />Fujin Yumi (Special Refine) |
| :-------: | ------------------------------------------------------------ |
| Passives: | Wings of Mercy 1/2/3<br />Escape Route 1/2/3<br />Flier Formation 1/2/3<br />Aerobatics 1/2/3<br />Warp PowderGuidance 1/2/3<br />Flier Guidance 1/2/3<br />Air Orders 1/2/3 |
|   Other   | Rival Domains/Grand Conquest warp tiles Grand Conquest bonus Guidance effect |

### f. Diagonal

此决定因素仅适用于标准移动。

假设其他所有条件均相等，则更接近追杀目标的任何对角线的格子都优先于其他图块的优先级。在目标直接对角线上的格子具有最高优先级。距对角线的距离以绝对距离表示，因此移动类型和障碍物不在考虑范围内。

![diagonal.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/diagonal.png?raw=true)

### g. Terrain

假设其他所有条件都相同，则地形更具限制性的位置的优先级高于其他位置。特殊地形的优先级为：飞行地形 > 树林 > 绊马索 >= 常规。绊马索 >= 常规仅适用于骑兵。飞行地形包括水，山脉，熔岩，深渊等。

### h. Movement

假设其他所有条件都相等，需要较少移动步数的格子比其他格子更具有优先权。如果该单位有“shuffle"状态，则不符合这一描述的。

### i. Tile Priority

假设所有其他条件均相等，格子编号越高，优先级越高。

## 4. Targeting Tiebreakers(关于目标)

### a. Combat Result

此优先级仅用于评估攻击。

假设所有其他条件均等，则导致最佳战斗结果的目标比其他敌方目标具有优先权。战斗的三种不同结果是胜利，平局和失败，其优先级也依该次排列。任何胜利都比任何平局都要好，任何平局都比任何损失都更好。如果某单位在战斗中击败对手，结果就是胜利。如果该回合没有单位被击杀，则视为平局。如果一个单位将会被他们的对手击杀，这就是失败（损失）。此优先级在Rival Domains（？？？）或Grand Conquest（大压制战）中不存在，也许是因为这种无限单位生成的对局需要较少的保守性的规则。（获胜目标需要主动进攻夺点，而不是以自保然后击杀敌军为目标）

### b. Debuffs Enemy

该因素仅仅用于攻击评估阶段。

假设其他所有条件均相等，则图表F中的技能减少至少2点单独def或单独res的目标具有高于其他单位的优先级。例如，这意味着如果攻击者可以用防守封印3造成-7 def，并且目标1没有减益效果，而目标2已经具有-6 def减益效果，那么目标1将具有优先级。它不关注将会减少多少防御或者魔防，只要debuff数量达到2以上的值并且具备适当的技能即可。拥有图表中的多种减防技能不会增加优先级。

### c. Damage Ratio

该因素仅仅用于攻击评估阶段。

假设其他所有条件都相等，则攻击者可能造成更高伤害的目标比其他目标具有更高的优先级。伤害率的计算公式如下：

==[造成的净伤害] * 3 - [受到的净伤害]==

净伤害是HP的变化量，也就是说，单位开始战斗和结束战斗的HP之间的差异。如果您对单位造成的超出其当前血量的伤害，仅将实际损失的生命值作为净伤害。这也说明由于吸收杖或者某些奥义在战斗中产生的治疗量会被考虑。受到10伤害，但是之后触发太阳治疗了10伤害，净伤害将被计算为0。请注意，恢复仅对恢复的实际HP有效。例如，如果艾克的生命值为45/45，受到0点伤害，然后触发天空，他将不会回血。这样，他的净伤害为0。

该公式基本上将造成伤害的值定为受到伤害的值的3倍。

因此，造成9点伤害和受到27点伤害与造成0点伤害同时受到0点伤害在计算时，公式的值相同。同样，回复目标HP会使该目标的优先级低得多。使敌人恢复10 HP（-10净伤害）等同于造成0点伤害并受到30点伤害。

AoE奥义（e.g. 烈风烈雷等地图炮）在计算公式时仅会计算对主目标带来的额外伤害，对其他目标造成的任何附带损害均与公式无关，不会参与计算进去。

### d. Increasing Special Charge(奥义计量增加)

该因素仅仅存用于攻击评估阶段。

假设其他所有条件均等，则在战斗结束前奥义计量会增加的目标要优先于其他目标。这常常是需要触发敌人的奥义，无论是进攻性奥义还是防御性奥义。仅仅触发它是不够的，因为这个变化量必须比战斗之前要高。举例来说，如果携带必杀枪的Lukas在战斗前奥义圣衣的CD转好了，并且被弓手攻击两次，奥义会触发然后又回到0CD就绪状态，这样奥义计量并不会增加，也就没有资格参与评估计算。奥义计量增加的数量无关紧要，只要增加了就好。

### e. Threatens Enemy

该决定因素仅仅用于支援评估。

假设其他所有条件均相等，则具有“威胁敌人”状态的目标比其他目标具有优先权。为了具有“威胁敌人”的地位，必须装备武器。

### f. Amount of stats buffed

该决定因素仅仅用于产生范围支援评估。

假设所有其他条件均等，则从一次支援中获得更多状态增益的目标比其他目标具有更高的优先级。例如，目标1的防御增益为+2，而目标2的防御增益为0。如果支援者具有防御支援，那么目标2将会因支援获得+4防御，而目标1只会获得+2，因此目标2具有更高的优先级。对于大喝，将移除的减益效果量添加到给定的效果量中。例如，如果一个单位有-7 def debuff和+6 def buff，那么由该因素判断，将为该单位提供8点stat buff。

### g. Amount Healed

该因素仅仅用于治疗支援评估。

假设所有其他条件均等，则获得更大治疗效果的目标将优先于其他目标。该条件下最有可能发生的情况是，治疗过剩；另一个情况是治疗者自身同时被治疗。

### h. Visible stat Total(白值)

该判断条件仅用于辅助评估阶段。

假设所有其他条件均等，则当前面板较大的目标比其他目标具有优先权。面板总计是atk，spd，def和res的组合，不包括HP。面板总计包括被加上buff和debuff的后的结果，但不包括Brazen Atk / Def或Ward Armors等战斗中的提升。

### i. Distance

该因素仅用于支援评估。

假设其他所有条件都相等，则距离最近的敌人更近的目标具有比其他目标更高的优先级。

### j. Chase Priority

该因素仅用于移动评估。

追逐优先级数量通过以下公式确定：

==【潜在的造成伤害量】 - 5 * 【追击回合数】==

造成的潜在伤害是指可以对目标造成的总伤害，包括超过目标生命值的伤害。它也包括追击，甚至是由于第一次击中造成击杀而通常不可能出现的追击。该单位自生和攻击目标携带的所有战斗中的被动武器都会影响这个数字，例如飞燕一击或稳定呼吸。而来自其他单位的战斗中效果（例如Spurs和Drives）则没有任何效果，但友军的支援除外（不要问我为什么）。根据附近敌人或盟友的数量获得战斗加成的技能，诸如Flame Siegmund，Swift Mulagir，Sawe Laws和Wolf Berg似乎总是在计算目标或被评估为目标时加分。影响追击的技能（例如打断技能或疾风横扫）将影响追击以计算此数字。不考虑奥义触发，不论是进攻性的还是防御性的。也不考虑该单位造成可能对自己的伤害，纯粹是潜在的造成伤害。

==这意味着目标是否可以反击与该公式无关。==

追击回合和距离计算很相似，但是有几个关键区别。追击回合的主要方面是它计算需要到达目标位置的回合总和，这与单位的移动距离成正比（走的越远，需要的回合就越多）。例如，距离近战步兵部队6格的目标将消耗3个追击回合。如果该单位是骑士，追击回合则变为2，而对于重装来说，这将是6个追击回合。诸如Armor March和Gravity之类的改变移动范围的效果都会影响此计算的移动范围。与距离计算不同，追击回合的计算将忽略目标站立的特殊地形。

具有通过状态的单位对追逐目标的计算有些不同。普通单位可以没毛病地以，在移动到目标地点过程中可以攻击到的任何敌人为目标。穿越效果相似，但“障碍物列表”中的图块是可攻击的无效图块（但是，它们不影响路径）。这意味着一个完全被不可逾越的障碍物包围的敌人，并且处于具有通过状态的近战单位无法追击目标。远程攻击同样如此，前提是必须有一个可以到达的位置，使得该单位可以攻击到它以追击敌人。

具有穿越效果的近战单位的距离如预期计算，但是带穿越效果的近战单位的追击回合总是以移动范围为1计算，无论其实际移动范围是多少。

![turnrange_meleeinf.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/turnrange_meleeinf.png?raw=true)

![turnrange_meleecav.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/turnrange_meleecav.png?raw=true)

远程单位的计算与近战单位略有不同，因为远程单位会从较远的格子中减去1，并且也忽略了与其目标相邻的特殊地形。

例如，目标目标距远程步兵部队5格，将具有2圈范围，因为5-1 = 4，而4 / [2移动范围]为2追击回合。即使目标前方有山峰，也将以这种方式为远程单位计算追击范围。请注意，虽然目标可以忽略远程单位的相邻地形，但它们仍将沿着他们可以移动的路径移向该单位。

![turnrange_rangedinf.png](https://github.com/ILikeIneine/FEH-AI-Analysis/blob/master/glossaryPics/turnrange_rangedinf.png?raw=true)

总而言之，该公式表明，目标每多追一个回合，就需要多承受5点伤害才能保持相等的价值。

### k. Terrain

该因素仅用于进攻性移动支援评估。

假设所有其他条件均等，则站在更具不可到达的特殊地形上的目标将比其他目标优先级更高。提醒一下，特殊的地形层次结构是：飞行地形>森林>沟壑> =常规（沟壑>常规仅适用于骑兵）。

### I. Tile Priority

该因素仅用于进攻性移动支援评估。

假设其他所有条件都相等，则站在优先级较高的图块上的目标将具有比其他目标更高的优先级。参考前面。

### m. Slot Order

假设其他所有条件均相等，则插槽号较高的目标将具有比其他目标更高的优先级。有关插槽顺序的更多详细信息，参考前面。

## 5. Action Priority Tiebreakers(行动优先级因素)

### a. Combat Result

该因素仅用于攻击评估。

假设所有其他条件均等，则具有最佳战斗结果的攻击者将比其他攻击者具有优先权。战斗的三种不同结果是胜利，平局和失败，其优先级依次排列。任何胜利都比任何平局都要好，任何平局都比任何损失都更好。

### b. Debuffs Enemy

参考4b

### c. Afflicts Enemies（？？？）

该因素仅用于评估攻击。假设其他所有条件都相等，则处于“折磨者”状态的攻击者将比其他攻击者具有优先权。请参阅图表G，以获取可以赋予“折磨者”状态的杂项减益技能的列表。装备多少技能或这些技能有多强无关紧要，只需要攻击者拥有即可。

如果攻击者的唯一折磨技能是蛇毒或恐慌烟雾，并且会战死，则该因素不适用。（死亡后的角色是无法触发战斗后生效的技能）

### d. Damage Ratio

refer to 4c

### e. Movement Range

此因素仅用于评估攻击阶段。

假设所有其他条件均等，则活动范围更大的攻击者将比其他攻击者具有优先权。这意味着骑兵将优先于步兵和飞行单位，后者优先于重甲。请注意，受此因素影响的移动范围将考虑会改变移动范围的技能效果，例如重装备行军和重压。

### f. Increasing Special Charge

refer to 4d

### g. Weapon vs Weaponless

该因素仅用于支援评估阶段和移动顺序表的创建。

对于战斗前支援，没有武器的支援者总是比其他有武器的支援者优先行动。对于战斗后支援，支援类型优先于是否装备武器。

对于移动列表的创建，假设其他所有条件都相同，则拥有武器的单位将在没有武器的单位之前执行标准移动。

### h. Distance

refer to 4i

### i . Non-Movement Assist Type

该因素仅适用于非移动支援评估阶段。

对于战斗前支援，假设所有其他条件均相等，则跳舞>恢复=治疗=牺牲=范围增益>防御性移动支援。

### j. Assist vs Assistless

该因素仅用于生成移动顺序列表。

没有支援的单位始终在有支援技能的单位之前执行标准移动。

### k. Melee vs Ranged

该因素仅用于生成移动顺序列表。

近战攻击单位将始终在远程攻击单位之前执行标准移动。

没有武器的单位将在近战和远程都完成攻击后执行标准移动。

### l. Slot Order

refer to 1a